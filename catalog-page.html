<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог - Кабинет депутата</title>
    <style>
        /* Общие стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Стили шапки */
        .header {
            background-color: #2c3e50;
            color: white;
            padding: 15px 0;
            margin-bottom: 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-name {
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.3s;
        }
        
        .user-name:hover {
            color: #ecf0f1;
        }
        
        .logout-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .back-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        /* Стили контента каталога */
        .catalog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .catalog-title {
            color: #2c3e50;
        }
        
        .upload-btn {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Форма загрузки */
        .upload-form {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }
        
        .upload-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-label {
            display: block;
            padding: 10px;
            background-color: #f8f9fa;
            border: 1px dashed #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
        }
        
        .file-input-label:hover {
            background-color: #e9ecef;
        }
        
        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: #2c3e50;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #1a252f;
        }
        
        .btn-secondary {
            background-color: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        
        /* Список документов */
        .documents-list {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .documents-header {
            padding: 15px 20px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .documents-title {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .documents-count {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .documents-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .documents-table th {
            background-color: #f1f1f1;
            padding: 12px 15px;
            text-align: left;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #ddd;
        }
        
        .documents-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .document-name {
            font-weight: 500;
        }
        
        .document-date {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .document-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .btn-view {
            background-color: #3498db;
            color: white;
        }
        
        .btn-download {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            color: white;
        }
        
        .no-documents {
            padding: 30px;
            text-align: center;
            color: #7f8c8d;
        }
        
        /* Модальное окно просмотра PDF */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            height: 90%;
            max-width: 1000px;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .modal-body {
            flex: 1;
            padding: 0;
            overflow: hidden;
        }
        
        .pdf-viewer {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .catalog-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .documents-table {
                display: block;
                overflow-x: auto;
            }
            
            .document-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <div class="header">
        <div class="container header-content">
            <h1>Кабинет депутата</h1>
            <div class="user-info">
                <span class="user-name" id="userName">Иванов И.И.</span>
                <button class="logout-btn" id="logoutBtn">Выйти</button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Кнопка возврата -->
        <button class="back-btn" id="backBtn">← Назад к каталогам</button>
        
        <!-- Заголовок каталога -->
        <div class="catalog-header">
            <h2 class="catalog-title" id="catalogTitle">Каталог</h2>
            <button class="upload-btn" id="uploadBtn">Загрузить документ</button>
        </div>
        
        <!-- Форма загрузки документа -->
        <div class="upload-form" id="uploadForm">
            <h3>Загрузка нового документа</h3>
            <div class="form-group">
                <label for="documentName">Название документа:</label>
                <input type="text" id="documentName" placeholder="Введите название документа">
            </div>
            <div class="form-group">
                <label for="documentDescription">Описание:</label>
                <textarea id="documentDescription" placeholder="Введите описание документа"></textarea>
            </div>
            <div class="form-group">
                <label for="documentDate">Дата документа:</label>
                <input type="date" id="documentDate">
            </div>
            <div class="form-group">
                <label for="documentFile">Файл документа (PDF):</label>
                <div class="file-input-wrapper">
                    <input type="file" id="documentFile" accept=".pdf">
                    <div class="file-input-label" id="fileInputLabel">Выберите PDF файл</div>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-secondary" id="cancelUploadBtn">Отмена</button>
                <button class="btn btn-primary" id="submitUploadBtn">Загрузить</button>
            </div>
        </div>
        
        <!-- Список документов -->
        <div class="documents-list">
            <div class="documents-header">
                <div class="documents-title">Документы каталога</div>
                <div class="documents-count" id="documentsCount">Всего документов: 0</div>
            </div>
            
            <table class="documents-table">
                <thead>
                    <tr>
                        <th width="40%">Название</th>
                        <th width="25%">Дата</th>
                        <th width="35%">Действия</th>
                    </tr>
                </thead>
                <tbody id="documentsTableBody">
                    <!-- Документы будут добавляться динамически -->
                </tbody>
            </table>
            
            <div class="no-documents" id="noDocumentsMessage">
                В этом каталоге пока нет документов. Загрузите первый документ.
            </div>
        </div>
    </div>
    
    <!-- Модальное окно просмотра PDF -->
    <div class="modal" id="pdfModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="pdfModalTitle">Просмотр документа</div>
                <button class="modal-close" id="pdfModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <iframe class="pdf-viewer" id="pdfViewer" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        // Данные текущего каталога
        let currentCatalog = null;
        let documents = [];
        let currentUser = null;

        // DOM элементы
        const elements = {
            backBtn: document.getElementById('backBtn'),
            uploadBtn: document.getElementById('uploadBtn'),
            uploadForm: document.getElementById('uploadForm'),
            documentName: document.getElementById('documentName'),
            documentDescription: document.getElementById('documentDescription'),
            documentDate: document.getElementById('documentDate'),
            documentFile: document.getElementById('documentFile'),
            fileInputLabel: document.getElementById('fileInputLabel'),
            cancelUploadBtn: document.getElementById('cancelUploadBtn'),
            submitUploadBtn: document.getElementById('submitUploadBtn'),
            documentsTableBody: document.getElementById('documentsTableBody'),
            noDocumentsMessage: document.getElementById('noDocumentsMessage'),
            documentsCount: document.getElementById('documentsCount'),
            pdfModal: document.getElementById('pdfModal'),
            pdfModalTitle: document.getElementById('pdfModalTitle'),
            pdfModalClose: document.getElementById('pdfModalClose'),
            pdfViewer: document.getElementById('pdfViewer'),
            catalogTitle: document.getElementById('catalogTitle'),
            userName: document.getElementById('userName'),
            logoutBtn: document.getElementById('logoutBtn')
        };

        // Инициализация приложения
        function initApp() {
            // Получаем данные о текущем каталоге из sessionStorage
            const catalogData = sessionStorage.getItem('currentCatalog');
            
            if (!catalogData) {
                alert('Каталог не выбран!');
                window.location.href = 'duma.html';
                return;
            }
            
            currentCatalog = JSON.parse(catalogData);
            
            // Получаем данные пользователя из localStorage
            const userData = localStorage.getItem('currentUser');
            if (userData) {
                currentUser = JSON.parse(userData);
                elements.userName.textContent = currentUser.name;
            }
            
            // Загружаем документы для текущего каталога
            loadCatalogDocuments();
            
            // Устанавливаем заголовок каталога
            elements.catalogTitle.textContent = currentCatalog.name;
            
            // Настройка обработчиков событий
            setupEventListeners();
        }

        // Загрузка документов каталога
        function loadCatalogDocuments() {
            // Получаем документы из localStorage
            const storedDocs = localStorage.getItem('catalogDocuments');
            let allDocuments = {};
            
            if (storedDocs) {
                allDocuments = JSON.parse(storedDocs);
            }
            
            // Получаем документы для текущего каталога
            documents = allDocuments[currentCatalog.id] || [];
            
            loadDocuments();
        }

        // Сохранение документов
        function saveDocuments() {
            // Получаем все документы из localStorage
            const storedDocs = localStorage.getItem('catalogDocuments');
            let allDocuments = {};
            
            if (storedDocs) {
                allDocuments = JSON.parse(storedDocs);
            }
            
            // Обновляем документы для текущего каталога
            allDocuments[currentCatalog.id] = documents;
            
            // Сохраняем обратно в localStorage
            localStorage.setItem('catalogDocuments', JSON.stringify(allDocuments));
        }

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Кнопка возврата
            elements.backBtn.addEventListener('click', () => {
                window.location.href = 'duma.html';
            });
            
            // Кнопка загрузки документа
            elements.uploadBtn.addEventListener('click', () => {
                elements.uploadForm.classList.add('active');
            });
            
            // Отмена загрузки
            elements.cancelUploadBtn.addEventListener('click', () => {
                elements.uploadForm.classList.remove('active');
                resetUploadForm();
            });
            
            // Подтверждение загрузки
            elements.submitUploadBtn.addEventListener('click', uploadDocument);
            
            // Изменение выбранного файла
            elements.documentFile.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    elements.fileInputLabel.textContent = e.target.files[0].name;
                } else {
                    elements.fileInputLabel.textContent = 'Выберите PDF файл';
                }
            });
            
            // Закрытие модального окна
            elements.pdfModalClose.addEventListener('click', () => {
                elements.pdfModal.classList.remove('active');
            });
            
            // Закрытие модального окна при клике вне его
            elements.pdfModal.addEventListener('click', (e) => {
                if (e.target === elements.pdfModal) {
                    elements.pdfModal.classList.remove('active');
                }
            });
            
            // Выход из системы
            elements.logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                window.location.href = 'duma.html';
            });
        }

        // Загрузка списка документов
        function loadDocuments() {
            elements.documentsTableBody.innerHTML = '';
            
            if (documents.length === 0) {
                elements.noDocumentsMessage.style.display = 'block';
                elements.documentsCount.textContent = 'Всего документов: 0';
                return;
            }
            
            elements.noDocumentsMessage.style.display = 'none';
            elements.documentsCount.textContent = `Всего документов: ${documents.length}`;
            
            documents.forEach(doc => {
                const row = document.createElement('tr');
                
                // Форматирование даты для отображения
                const displayDate = new Date(doc.date).toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td>
                        <div class="document-name">${doc.name}</div>
                        <div class="document-description">${doc.description}</div>
                    </td>
                    <td class="document-date">${displayDate}</td>
                    <td>
                        <div class="document-actions">
                            <button class="btn-small btn-view" data-id="${doc.id}">Просмотр</button>
                            <button class="btn-small btn-download" data-id="${doc.id}">Скачать</button>
                            <button class="btn-small btn-delete" data-id="${doc.id}">Удалить</button>
                        </div>
                    </td>
                `;
                
                elements.documentsTableBody.appendChild(row);
            });
            
            // Добавление обработчиков для кнопок действий
            document.querySelectorAll('.btn-view').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const docId = parseInt(e.target.getAttribute('data-id'));
                    viewDocument(docId);
                });
            });
            
            document.querySelectorAll('.btn-download').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const docId = parseInt(e.target.getAttribute('data-id'));
                    downloadDocument(docId);
                });
            });
            
            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const docId = parseInt(e.target.getAttribute('data-id'));
                    deleteDocument(docId);
                });
            });
        }

        // Загрузка документа
        function uploadDocument() {
            const name = elements.documentName.value;
            const description = elements.documentDescription.value;
            const date = elements.documentDate.value;
            const file = elements.documentFile.files[0];
            
            // Валидация
            if (!name || !description || !date || !file) {
                alert('Заполните все поля и выберите файл!');
                return;
            }
            
            if (file.type !== 'application/pdf') {
                alert('Пожалуйста, выберите файл в формате PDF!');
                return;
            }
            
            // Создаем новый документ
            const newDocument = {
                id: documents.length > 0 ? Math.max(...documents.map(d => d.id)) + 1 : 1,
                name,
                description,
                date,
                fileName: file.name,
                fileUrl: URL.createObjectURL(file) // Временная ссылка для демонстрации
            };
            
            documents.push(newDocument);
            
            // Сохраняем документы
            saveDocuments();
            
            // Обновление интерфейса
            loadDocuments();
            
            // Сброс формы
            resetUploadForm();
            elements.uploadForm.classList.remove('active');
            
            alert('Документ успешно загружен!');
        }

        // Просмотр документа
        function viewDocument(id) {
            const doc = documents.find(d => d.id === id);
            if (!doc) return;
            
            elements.pdfModalTitle.textContent = doc.name;
            elements.pdfViewer.src = doc.fileUrl;
            elements.pdfModal.classList.add('active');
        }

        // Скачивание документа
        function downloadDocument(id) {
            const doc = documents.find(d => d.id === id);
            if (!doc) return;
            
            // Создаем временную ссылку для скачивания
            const link = document.createElement('a');
            link.href = doc.fileUrl;
            link.download = doc.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Удаление документа
        function deleteDocument(id) {
            if (confirm('Вы уверены, что хотите удалить этот документ?')) {
                documents = documents.filter(d => d.id !== id);
                
                // Сохраняем изменения
                saveDocuments();
                
                loadDocuments();
            }
        }

        // Сброс формы загрузки
        function resetUploadForm() {
            elements.documentName.value = '';
            elements.documentDescription.value = '';
            elements.documentDate.value = '';
            elements.documentFile.value = '';
            elements.fileInputLabel.textContent = 'Выберите PDF файл';
        }

        // Запуск приложения
        initApp();
    </script>
</body>
</html>